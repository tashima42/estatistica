---
title: "Grupo 6"
author: "Thiago Cezario, 
Pedro Henrique Mateus Tashima,
Ricardo Jonas de Assis"
date: "2025-06-10"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, results='hide', message=FALSE}
###
# Declarando caminho, definições e pacotes
###

# Diretório do projeto, de onde serão salvos e lidos os arquivos
project_root_path <- paste0(getwd(), "/")

###
# Variáveis e definições
###
source(paste0(project_root_path, "/definitions.R"))

###
# Instalando e carregando pacotes 
###
source(paste0(project_root_path, "/install_load_packages.R"), encoding = encoding)

# 1. Carregamento dos dados
#dados <- diamonds
str(dados)
# 2. Tratamento dos dados

dados <- dados %>% 
  dplyr::mutate(color_adj = dplyr::case_when(color %in% c('D', 'E', 'F') ~ 'Incolor',
                                         TRUE ~ 'Colorido'))

dados <- dados %>%
  dplyr::mutate(cut_adj = factor(dados$cut,
                                      ordered = TRUE
                                      ))
dados <- dados %>%
  dplyr::mutate(color_adj = factor(dados$color_adj))

```

## Análise exploratória dos dados

O conjunto de dados *diamonds* é composto pelo preço, peso, cor, corte e outras informações de 53940 diamantes.

```{r, results='show'}
head(dados)
str(dados)
summary(dados)
```


Diamantes com as cores "D", "E", "F", foram agrupados, como incolores e os diamantes com cores "G", "H", "I" e "J", como coloridos. Os dois grupos tem uma proporção, similar, mas o grupo colorido é maior, sendo 51.6% da amostra.

```{r, results='show'}
table(dados$color_adj)
round(prop.table(table(dados$color_adj)) * 100, 1)
barplot(table(dados$color_adj), ylim = c(0,30000), col=c("lightblue", "white"))
```



```{r, results='show'}
# Cor - Quali
# Corte - Quali
## Frequencia absoluta
barplot(table(dados$cut), ylim = c(0,30000), col = rainbow(nrow(table(dados$cut))))
round(prop.table(table(dados$cut)) * 100, 1)
```

```{r, results='show'}
## Frequencia relativa
# TBD

# Preço - Quanti
# Peso - Quanti
hist(dados$price)
boxplot(dados$price)
car::qqPlot(dados$price)
```

```{r, results='show'}
#hist(dados$carat)
boxplot(dados$carat)
car::qqPlot(dados$carat)
```

Total: 53940 diamantes com cortes:

1610 Fair

4906 Good

12082 Very Good

13791 Premium

21551 Ideal

Cores:

27826 Coloridos

26114 Incolores

## Existe correlação entre o preço e o peso do diamante?

Correlação: `r cor(dados$price, dados$carat, method = "spearman")`

```{r}
# 1. existe correlação entre preço e peso do diamante?
## H0: Preço não acompanha o peso
## H1: O preço acompanha o peso.

## Alfa = 0.05
plot(dados$price, dados$carat)
sd(dados$carat)
sd(dados$price)

ad.test(dados$price)
ad.test(dados$carat)

```

### H0 rejeitada, dados não são normais. Conclusão: Existe uma correlação positiva e significativa entre peso e preço.

# 2. existe diferença no preço do diamante de acordo com o tipo de corte?

```{r}

## H0: O preço não muda com o corte
## H1: O preço muda com o cortes

sd(dados$price)

boxplot(dados$price ~ dados$cut)

dados %>% 
  group_by(cut) %>% 
  summarise(
    quantidade = n(),
    preco_medio = round(mean(price), 0),
    preco_mediano = round(median(price), 0)
  )

dunn.test(dados$price, dados$cut, method = "bonferroni")
## Conclusão: p <= alpha/2, então hipótese nula é descartada. O preço varia com o corte.

# 3. existe diferença no preço dos diamantes coloridos e incolores?

## H0: O preço não muda com as cores
## H1: O preço muda com as cores

boxplot(dados$price ~ dados$color_adj)
wilcox.test(price ~ color_adj, data = dados)

dados %>% 
  group_by(color_adj) %>% 
  summarise(
    quantidade = n(),
    preco_medio = round(mean(price), 0),
    preco_mediano = round(median(price), 0)
  )

hist(dados$price[dados$color_adj == 'Incolor'], ylim = c(0, 8000))
hist(dados$price[dados$color_adj == 'Colorido'], ylim = c(0, 8000))

## H0: descartada, o preço varia com a cor. Diamantes coloridos tendem a ter um preço médio e mediano maior que os incolores, porém os incolores tem uma quantidade considerável de outliers com preços elevados.
```